---
title: "Tidy Tuesday (2025-09-23): FIDE Chess Player Ratings"
format: html
date: last-modified
execute:
    cache: true
code-fold: true
---

# Libraries

```{r}
#| label: libraries
#| warning: false

library(tidyverse)
```

# Intro

## FIDE Chess Player Ratings Background (*[Git](https://www.fide.com/fide-september-2025-rating-list-vincent-keymer-debuts-in-top-10-open/)*)

This week we're exploring August and September chess player rating data from FIDE (the International Chess Federation). Monthly data files are published on the [FIDE website](https://www.fide.com/fide-september-2025-rating-list-vincent-keymer-debuts-in-top-10-open/).

A chess rating (Elo) is an estimate of a player's strength relative to other players. If a player performs better or worse than expected, their rating increases or decreases accordingly.

The September 2025 rating list was shaped primarily by results from the Sinquefield Cup, Quantbox Chennai Grand Masters, 61st International Akiba Rubinstein Chess Festival, and the Spanish League Honor Division 2025 â€“ a Swiss team tournament held in Linares.

**Questions**

- Which players showed the greatest improvement from August to September?
- Which federations have the most number of titled players?
- How did the rankings of the top male or female players change?
- Who are the top youth players?

Thank you to Jessica Moore for curating this week's dataset.

## Cleaning Data

Cleaning script provided by readme on [Git](https://www.fide.com/fide-september-2025-rating-list-vincent-keymer-debuts-in-top-10-open/).

Script makes use of the *withr* package, which I've never seen or used. According to the [documentation](https://github.com/r-lib/withr#readme), *withr* helps run code with safely and temporily modified global state so that code is less error-prone.

Also, the data comes as a txt where each column has fixed width. As such, the script uses *readr::read_fwf*.

The script fixes up some names with regex, filters to active players (past year) using the **flag** column, then drops the **flag** column.

## Loading Data

```{r}
#| label: load-data 
#| output: false

tuesdata <- tidytuesdayR::tt_load('2025-09-23')

fide_ratings_august <- tuesdata$fide_ratings_august
fide_ratings_september <- tuesdata$fide_ratings_september
```

# Exploratory Analysis

```{r}
#| label: wrangle

c_col_type_int <- c(

)

tb_ratings_august <- fide_ratings_august |>
    filter(games > 0) |> 
    mutate(
        across(where(is.double), as.integer),
        across(!name & where(is.character), as.factor),
        age = year(today()) - bday
        ) |> 
    mutate(age_range = case_when(
        between(age, 5, 9) ~ "5 - 9",
        between(age, 10, 14) ~ "10 - 14",
        between(age, 15, 19) ~ "15 - 19",
        between(age, 20, 24) ~ "20 - 24",
        between(age, 25, 29) ~ "25 - 29",
        between(age, 30, 39) ~ "30 - 39",
        between(age, 40, 49) ~ "40 - 49",
        between(age, 50, 69) ~ "50 - 59",
        age >= 60 ~ "over 60",
    )) |> 
    mutate(age_range = factor(
        age_range, 
        c("5 - 9", "10 - 14", "15 - 19", "20 - 24", "25 - 29", 
        "30 - 39", "40 - 49", "50 - 59", "over 60"))) |> 
    relocate(age_range)

view(tb_ratings_august)
```

```{r}
#| label: basic-stats

n_active_aug <- length(fide_ratings_august$id)
n_logged_aug <- length(tb_ratings_august$id)
percent_log_aug <- round(n_logged_aug / n_active_aug * 100, 0)
```

Of the **`r n_active_aug`** active players in August, **`r n_logged_aug` (`r percent_log_aug`%)** FIDE chess players actually logged a game that month.


```{r}
#| label: age-stats

tb_age_quant_aug <- tb_ratings_august |>
    group_by(sex) |> 
    reframe(
        prob = c(0, 0.1, 0.5, 0.9, 1),
        quant = quantile(age, prob)
        )

# plt_age_hist_aug <- 
tb_ratings_august |> 
    ggplot(aes((year(today()) - bday))) +
    geom_histogram() +
    labs(x = "age")
```

```{r}
#| label: age-rating-stats

tb_age_rating_aug <- tb_ratings_august |> 
    group_by(age, sex) |> 
    summarize(
        n_people = n(),
        median_rating = median(rating)
        ) |> 
    relocate(sex, 1) |> 
    arrange(sex, age)

tb_age_rating_aug |> 
    ggplot(aes(age, median_rating, size = n_people, alpha = 0.7)) +
    geom_point() +
    facet_wrap(vars(sex))
```


```{r}
#| label: title-stats

tb_title_summary <- tb_ratings_august |> 
    group_by(sex) |> 
    count(title, name = "n_people") |> 
    add_count(sex, wt = n_people, name = "total") |> 
    mutate(percent_title = round(n_people / total * 100, 2))

tb_ratings_august |> 
    filter(!is.na(title)) |> 
    ggplot(aes(title)) +
    geom_histogram(stat = "count") +
    facet_wrap(vars(sex))
```

```{r}
#| label: sex-ratio-age

tb_sex_ratio <- tb_ratings_august |> 
    group_by(sex, fed) |> 
    count(age_range, name = "n_people") |> 
    pivot_wider(names_from = sex, values_from = n_people) |> 
    mutate(sex_ratio = M / F)

tb_sex_ratio |> 
    ggplot(aes(fct_rev(age_range), sex_ratio, size = F + M)) +
    geom_point() +
    labs(x = "age", y = "sex ratio (M:F)")
```

Wanted to look at sex ratios by Fed, but there are 166 Feds. Might be cool to make a map of total chess players and sex ratio by Fed over time.